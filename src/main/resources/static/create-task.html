<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create Task</title>

  <style>
    :root{
      --bg1:#0ea5e9;   /* sky */
      --bg2:#6366f1;   /* indigo */
      --card:#ffffffcc;
      --cardBorder:#ffffff55;
      --text:#0f172a;  /* slate-900 */
      --muted:#475569; /* slate-600 */
      --shadow: 0 18px 55px rgba(2, 6, 23, .20);
      --radius: 18px;
      --ring:#60a5fa;

      --ok:#10b981;
      --bad:#ef4444;
      --warn:#f59e0b;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      padding: 26px;

      background:
        radial-gradient(1200px 650px at 12% 10%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(1000px 520px at 90% 18%, rgba(255,255,255,.22), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    .container{
      max-width: 980px;
      margin: 0 auto;
    }

    /* ---------- Top Bar ---------- */
    .topbar{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 18px;
    }

    .titleBlock{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 260px;
    }

    .logo{
      width:44px;
      height:44px;
      border-radius:16px;
      display:grid;
      place-items:center;
      color:#fff;
      font-weight:800;
      letter-spacing:.4px;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.30);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 26px rgba(2,6,23,.18);
      user-select:none;
    }

    h1{
      margin:0;
      font-size: 24px;
      letter-spacing:-0.02em;
      color:#fff;
      line-height:1.1;
    }

    .subtitle{
      margin:2px 0 0 0;
      font-size: 13px;
      color: rgba(255,255,255,.86);
    }

    .spacer{ flex: 1; }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.32);
      background: rgba(255,255,255,.16);
      color:#fff;
      text-decoration:none;
      cursor:pointer;
      backdrop-filter: blur(10px);
      transition: transform .06s ease, filter .15s ease, background .15s ease;
      box-shadow: 0 10px 22px rgba(2,6,23,.14);
      font-size: 13px;
      font-weight: 650;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ filter: brightness(1.05); background: rgba(255,255,255,.20); }
    .btn:active{ transform: translateY(1px); }

    .btnPrimary{
      border-color: rgba(255,255,255,.45);
      background: rgba(255,255,255,.22);
    }

    .btnDanger{
      border-color: rgba(255,255,255,.35);
      background: rgba(255,255,255,.16);
    }

    .btnIcon{ width:16px; height:16px; opacity:.92; }

    form.logoutForm{ margin:0; }

    /* ---------- Shell ---------- */
    .shell{
      border-radius: var(--radius);
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }

    .shellHeader{
      padding: 18px 18px 0 18px;
    }
    .shellHeader h2{
      margin:0;
      color:#fff;
      font-size: 16px;
      font-weight: 800;
      letter-spacing:-0.01em;
    }
    .shellHeader p{
      margin: 6px 0 0 0;
      color: rgba(255,255,255,.86);
      font-size: 13px;
      line-height:1.4;
      max-width: 72ch;
    }

    .divider{
      height:1px;
      background: rgba(255,255,255,.20);
      margin: 16px 0;
    }

    /* ---------- Form Card ---------- */
    .card{
      margin: 0 18px 18px 18px;
      border-radius: 18px;
      background: var(--card);
      border:1px solid var(--cardBorder);
      box-shadow: 0 14px 34px rgba(2,6,23,.14);
      overflow:hidden;
      position:relative;
    }
    .card:before{
      content:"";
      position:absolute; inset:-1px;
      background: radial-gradient(650px 260px at 18% 0%, rgba(255,255,255,.45), transparent 55%);
      pointer-events:none;
    }
    .cardInner{ position:relative; padding: 18px; }

    /* ---------- Fields ---------- */
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      font-size: 12px;
      font-weight: 650;
      color: var(--muted);
      margin-top: 12px;
      letter-spacing: .01em;
    }

    .field{
      position:relative;
      margin-top: 6px;
    }

    input, textarea, select{
      width: 100%;
      padding: 12px 12px 12px 42px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.14);
      background: rgba(255,255,255,.85);
      font-size: 14px;
      line-height: 1.4;
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
    }

    textarea{
      min-height: 120px;
      resize: vertical;
      padding-top: 12px;
    }

    select{
      appearance:none;
      padding-right: 42px;
    }

    input:focus, textarea:focus, select:focus{
      border-color: rgba(96,165,250,.8);
      box-shadow: 0 0 0 4px rgba(96,165,250,.28);
    }

    .icon{
      position:absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      opacity: .55;
      pointer-events:none;
    }
    .iconTop{
      top: 18px; /* for textarea */
      transform: none;
    }

    .chev{
      position:absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      opacity: .55;
      pointer-events:none;
    }

    .help{
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.35;
    }

    /* ---------- Buttons ---------- */
    .btnRow{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top: 16px;
    }

    .actionBtn{
      border:0;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 750;
      font-size: 14px;
      cursor:pointer;
      color:#fff;
      background: linear-gradient(135deg, rgba(99,102,241,1), rgba(14,165,233,1));
      box-shadow: 0 10px 24px rgba(2,6,23,.20);
      transition: transform .06s ease, filter .15s ease, box-shadow .15s ease;
      white-space:nowrap;
    }
    .actionBtn:hover{ filter: brightness(1.03); box-shadow: 0 14px 30px rgba(2,6,23,.26); }
    .actionBtn:active{ transform: translateY(1px); }

    .ghostBtn{
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 750;
      font-size: 14px;
      cursor:pointer;
      border: 1px solid rgba(15,23,42,.14);
      background: rgba(255,255,255,.72);
      color: #0f172a;
      transition: transform .06s ease, filter .15s ease, background .15s ease;
      white-space:nowrap;
    }
    .ghostBtn:hover{ filter: brightness(1.02); background: rgba(255,255,255,.86); }
    .ghostBtn:active{ transform: translateY(1px); }

    /* ---------- Result ---------- */
    .resultBox{
      margin-top: 14px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.65);
      white-space: pre-wrap;
      font-size: 13px;
      line-height: 1.45;
    }
    .msgOk{
      color: #065f46;
      font-weight: 750;
      border-left: 4px solid rgba(16,185,129,.75);
      padding-left: 10px;
    }
    .msgErr{
      color: #7f1d1d;
      font-weight: 750;
      border-left: 4px solid rgba(239,68,68,.75);
      padding-left: 10px;
    }

    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; }
    }
  </style>
</head>

<body>
<div class="container">

  <!-- ---------- Header ---------- -->
  <div class="topbar">
    <div class="titleBlock">
      <div class="logo">TB</div>
      <div>
        <h1>Create Task</h1>
        <div class="subtitle">Fill details, assign a user, and submit for approval</div>
      </div>
    </div>

    <div class="spacer"></div>

    <div class="actions">
      <a class="btn" href="/tasks.html">
        <svg class="btnIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M8 6h12M8 12h12M8 18h12" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M4 6h.01M4 12h.01M4 18h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
        </svg>
        Tasks
      </a>

      <a class="btn" href="/dashboard.html">
        <svg class="btnIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 11l8-7 8 7v9a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-9Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
          <path d="M9.5 22v-7h5v7" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
        Dashboard
      </a>

      <form class="logoutForm" action="/logout" method="post" onsubmit="return confirm('Logout now?');">
        <button class="btn btnDanger" type="submit" title="Logout">
          <svg class="btnIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10 7V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2v-1" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M3 12h11" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M7 8l-4 4 4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Logout
        </button>
      </form>
    </div>
  </div>

  <!-- ---------- Shell ---------- -->
  <section class="shell">
    <div class="shellHeader">
      <h2>Task Details</h2>
      <p>
        Provide a clear title, helpful context, and the schedule. Choose priority and assign a user.
      </p>
    </div>

    <div class="divider"></div>

    <div class="card">
      <div class="cardInner">
        <form id="taskForm">

          <label for="title">Title</label>
          <div class="field">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M8 6h13M8 12h13M8 18h13" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M3 6h.01M3 12h.01M3 18h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            </svg>
            <input id="title" required placeholder="e.g. Prepare Q1 status report" />
          </div>
          <div class="help">Keep it short and action-oriented.</div>

          <label for="description">Description</label>
          <div class="field">
            <svg class="icon iconTop" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M8 6h12M8 10h12M8 14h12M8 18h8" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M4 6h.01M4 10h.01M4 14h.01M4 18h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            </svg>
            <textarea id="description" rows="4" placeholder="Add context, acceptance criteria, links, or notes…"></textarea>
          </div>
          <div class="help">Optional, but recommended for faster approvals.</div>

          <div class="grid">
            <div>
              <label for="taskDateTime">Date / Time</label>
              <div class="field">
                <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M7 3v3M17 3v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M4.5 8.5h15" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M6.5 5.5h11A2 2 0 0 1 19.5 7.5v12A2 2 0 0 1 17.5 21.5h-11A2 2 0 0 1 4.5 19.5v-12A2 2 0 0 1 6.5 5.5Z" stroke="currentColor" stroke-width="1.8"/>
                  <path d="M12 12v4l3 1.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <input id="taskDateTime" type="datetime-local" required />
              </div>
              <div class="help">Defaults to one hour from now.</div>
            </div>

            <div>
              <label for="priority">Priority</label>
              <div class="field">
                <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M5 20V4l14 4-14 4" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                  <path d="M5 20h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
                <select id="priority" required>
                  <option value="LOW">LOW</option>
                  <option value="MEDIUM" selected>MEDIUM</option>
                  <option value="HIGH">HIGH</option>
                </select>
                <svg class="chev" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="help">Use HIGH for urgent items needing quick approval.</div>
            </div>
          </div>

          <label for="assignedUserId">Assigned User</label>
          <div class="field">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 12a4.5 4.5 0 1 0-4.5-4.5A4.5 4.5 0 0 0 12 12Z" stroke="currentColor" stroke-width="1.8"/>
              <path d="M4 20c1.6-4 5-6 8-6s6.4 2 8 6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
            <select id="assignedUserId" required></select>
            <svg class="chev" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="help">This user will get notified when the task is created and decided.</div>

          <div class="btnRow">
            <button class="actionBtn" type="submit">Create Task</button>
            <button class="ghostBtn" type="button" id="resetBtn">Reset</button>
          </div>

        </form>

        <div id="result" class="resultBox">
          Fill the form and click <b>Create Task</b>.
        </div>
      </div>
    </div>
  </section>

</div>

<!-- ---------- Script (same logic, slightly nicer messages) ---------- -->
<script>
  async function fetchJson(url, options = {}) {
    const res = await fetch(url, options);
    if (!res.ok) throw new Error(await res.text());
    return res.json();
  }

  function toIsoFromDatetimeLocal(value) {
    return value.length === 16 ? value + ":00" : value;
  }

  function setDefaultDateTime() {
    const input = document.getElementById("taskDateTime");
    const d = new Date();
    d.setHours(d.getHours() + 1);
    d.setSeconds(0, 0);

    const pad = n => String(n).padStart(2, "0");
    input.value =
      d.getFullYear() + "-" +
      pad(d.getMonth() + 1) + "-" +
      pad(d.getDate()) + "T" +
      pad(d.getHours()) + ":" +
      pad(d.getMinutes());
  }

  async function loadUsers() {
    const users = await fetchJson("/api/users");
    const sel = document.getElementById("assignedUserId");
    sel.innerHTML = "";

    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = "-- Select user --";
    placeholder.disabled = true;
    placeholder.selected = true;
    sel.appendChild(placeholder);

    users.forEach(u => {
      const opt = document.createElement("option");
      opt.value = u.id;
      opt.textContent = `${u.username} (${u.role})`;
      sel.appendChild(opt);
    });
  }

  function setResultOk(text) {
    document.getElementById("result").innerHTML =
      `<div class="msgOk">${text}</div>`;
  }

  function setResultErr(text) {
    document.getElementById("result").innerHTML =
      `<div class="msgErr">${text}</div>`;
  }

  document.getElementById("resetBtn").addEventListener("click", () => {
    document.getElementById("taskForm").reset();
    setDefaultDateTime();
    document.getElementById("result").textContent = "Form reset.";
  });

  document.getElementById("taskForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const assignedVal = document.getElementById("assignedUserId").value;
    if (!assignedVal) {
      setResultErr("Please select an assigned user.");
      return;
    }

    const payload = {
      title: document.getElementById("title").value.trim(),
      description: document.getElementById("description").value.trim(),
      taskDateTime: toIsoFromDatetimeLocal(document.getElementById("taskDateTime").value),
      priority: document.getElementById("priority").value,
      assignedUserId: Number(assignedVal)
    };

    try {
      const created = await fetchJson("/api/tasks", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      setResultOk(`✅ Task #${created.id} created successfully (status: ${created.status}).`);

    } catch (err) {
      setResultErr("❌ Error creating task: " + err.message);
    }
  });

  (async function init() {
    try {
      await loadUsers();
      setDefaultDateTime();
    } catch (e) {
      document.body.innerHTML = `
        <div style="max-width:680px;margin:80px auto;color:#fff;font-family:system-ui">
          <h2 style="margin:0 0 10px 0;">Session expired</h2>
          <p style="margin:0 0 16px 0;opacity:.9;">Please sign in again to continue.</p>
          <a href="/login.html" style="display:inline-block;padding:10px 12px;border-radius:12px;background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.28);color:#fff;text-decoration:none;">Go to Login</a>
          <pre style="margin-top:14px;white-space:pre-wrap;opacity:.85;">${e.message}</pre>
        </div>`;
    }
  })();
</script>
</body>
</html>
